<% set_full_title("#{@question.user.name}さんの質問") %>
<div class="row">
  <%= render 'shared/user_sidebar' %>
  <div class="question-show col-md-8">
    <div class="user">
      <%= link_to get_gravatar_img(@question.user, size: 35), @question.user,class:"d-inline" %>
      <span class="user"><%= @question.user.name %></span>
    </div>
    <h5 class="lead">
      <% if @question.solved? %>
        <span class="solved-badge badge badge-success">解決済!</span>
      <% end %>
      <%= @question.title %>
    </h5>
    <hr>
    <p><%= @question.content %></p>
    <%= image_tag @question.display_image , class:"rounded mb-3" if @question.image.attached? %>
    <!-- 主投稿の削除リンク -->
    <div class="d-flex justify-content-end align-items-center">
      <% #いいねボタン %>
      <div id="like-button" class="d-inline-block mr-3">
        <%= render partial:'likes/like' , locals:{question: @question,like:@like} %>
      </div>
      <% if current_user?(@question.user) %>
          <%= link_to @question, method: :delete, class:"btn btn-outline-danger" ,data:{confirm:"この投稿を削除しますか？"} do %>
            <span class="far fa-trash-alt"></span>
          <% end %>
      <% end %>
      <% #解決済み質問にはコメント投稿できないようにする %>
      <% unless @question.solved? %>
        <a href="#" class="icon ml-3 btn btn-primary btn-large d-block text-right" data-toggle="collapse" data-target="#new-comment-form-parent-nil-<%=@question.id %>">
          <span class="fas fa-reply"></span> 返信
        </a>
      <% end %>
    </div>

  <div class="collapse" id="new-comment-form-parent-nil-<%= @question.id %>">
    <!-- 質問に対する返信のためフォームの返信元にはnilを入れておく。 -->
    <%= render 'comments/new_comment', parent: nil%>
  </div>
  <hr>
    <!-- コメントを表示する -->
    <%= render @comments %>

  </div>
</div>
<script type="text/javascript">
//投稿の画像投稿時のファイル容量バリデーション
  $("#comment_image").bind("change", function() {
    var size_in_megabytes = this.files[0].size/1024/1024;
    if (size_in_megabytes > 8) {
      alert("ファイルサイズが大きすぎます。８MB以下のファイルを指定してください。");
      $("#comment_image").val("");
    }
  })
</script>